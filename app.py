from flask import Flask, request
import telegram
import os
import asyncio
from datetime import datetime

app = Flask(__name__)

TOKEN = os.getenv('TOKEN')
bot = telegram.Bot(token=TOKEN)

@app.route('/webhook', methods=['POST'])
def webhook():
    update = telegram.Update.de_json(request.get_json(force=True), bot)
    if update.message:
        message_text = update.message.text.lower()
        chat_id = update.message.chat_id
        user_name = update.message.from_user.first_name or "–ö–ª–∏–µ–Ω—Ç"
        original_text = update.message.text
        
        try:
            # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            if any(word in message_text for word in ['/start', '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ', '–¥–æ–±—Ä—ã–π']):
                reply = f"–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {user_name}! üëã\n\n–Ø –±–æ—Ç RCC Lines –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä—É–∏–∑–æ–≤.\n\nüìã –ö–æ–º–∞–Ω–¥—ã:\n‚Ä¢ '–∑–∞–∫–∞–∑' - –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫—Ä—É–∏–∑\n‚Ä¢ '—Ü–µ–Ω—ã' - —É–∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å\n‚Ä¢ '–∫—Ä—É–∏–∑—ã' - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã\n‚Ä¢ '–∫–æ–Ω—Ç–∞–∫—Ç—ã' - —Å–≤—è–∑—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º"
            
            # –ó–∞–∫–∞–∑—ã
            elif any(word in message_text for word in ['–∑–∞–∫–∞–∑', '–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', 'cruise', '–±—Ä–æ–Ω—å']):
                order_id = f"#{chat_id}{datetime.now().strftime('%H%M')}"
                reply = f"‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç, {user_name}!\n\nüìã –í–∞—à –∑–∞–ø—Ä–æ—Å: '{original_text}'\nüé´ –ù–æ–º–µ—Ä –∑–∞—è–≤–∫–∏: {order_id}\n\nüìû –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç.\n\n–î–ª—è —Å—Ä–æ—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤: +7 (800) 555-35-35"
            
            # –ö—Ä—É–∏–∑—ã
            elif any(word in message_text for word in ['–∫—Ä—É–∏–∑', '–º–∞—Ä—à—Ä—É—Ç', '–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è']):
                reply = "üö¢ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫—Ä—É–∏–∑—ã RCC Lines:\n\n1Ô∏è‚É£ –°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—å–µ (7 –¥–Ω–µ–π) - –æ—Ç 890‚Ç¨\n2Ô∏è‚É£ –ö–∞—Ä–∏–±—ã (10 –¥–Ω–µ–π) - –æ—Ç 1200$\n3Ô∏è‚É£ –ù–æ—Ä–≤–µ–∂—Å–∫–∏–µ —Ñ—å–æ—Ä–¥—ã (5 –¥–Ω–µ–π) - –æ—Ç 750‚Ç¨\n4Ô∏è‚É£ –í–æ–ª–≥–∞ (3 –¥–Ω—è) - –æ—Ç 15000‚ÇΩ\n\nüí° –î–ª—è –∑–∞–∫–∞–∑–∞ –Ω–∞–ø–∏—à–∏—Ç–µ '–∑–∞–∫–∞–∑' + –Ω–æ–º–µ—Ä –∫—Ä—É–∏–∑–∞"
            
            # –¶–µ–Ω—ã
            elif any(word in message_text for word in ['—Ü–µ–Ω', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '—Å–∫–æ–ª—å–∫–æ', '–ø—Ä–∞–π—Å']):
                reply = "üí∞ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã:\n\nüåä –°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—å–µ: 890-2500‚Ç¨\nüèùÔ∏è –ö–∞—Ä–∏–±—ã: 1200-3500$\nüèîÔ∏è –ù–æ—Ä–≤–µ–≥–∏—è: 750-2200‚Ç¨\nüõ•Ô∏è –í–æ–ª–≥–∞: 15000-45000‚ÇΩ\n\nüìù –¢–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:\n‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞—é—Ç—ã\n‚Ä¢ –°–µ–∑–æ–Ω–∞\n‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–µ–ª–æ–≤–µ–∫\n\n–î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞–ø–∏—à–∏—Ç–µ '–∑–∞–∫–∞–∑'"
            
            # –ö–æ–Ω—Ç–∞–∫—Ç—ã
            elif any(word in message_text for word in ['–∫–æ–Ω—Ç–∞–∫—Ç', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–º–µ–Ω–µ–¥–∂–µ—Ä', '—Å–≤—è–∑—å']):
                reply = "üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã RCC Lines:\n\n‚òéÔ∏è –¢–µ–ª–µ—Ñ–æ–Ω: +7 (800) 555-35-35\nüìß Email: info@rcclines.com\nüïò –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã: 9:00-21:00 –ú–°–ö\nüåê –°–∞–π—Ç: rcclines.com\n\nüí¨ –ò–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É –∑–¥–µ—Å—å!"
            
            # –ü–æ–º–æ—â—å
            elif any(word in message_text for word in ['–ø–æ–º–æ—â—å', 'help', '?', '–∫–æ–º–∞–Ω–¥—ã']):
                reply = "‚ÑπÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n\nüé´ '–∑–∞–∫–∞–∑' - –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫—Ä—É–∏–∑\nüí∞ '—Ü–µ–Ω—ã' - —É–∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å\nüö¢ '–∫—Ä—É–∏–∑—ã' - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã\nüìû '–∫–æ–Ω—Ç–∞–∫—Ç—ã' - —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏\nüëã '–ø—Ä–∏–≤–µ—Ç' - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\n\nüí° –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ!"
            
            # –û–±—â–∏–π –æ—Ç–≤–µ—Ç
            else:
                reply = f"–°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ, {user_name}! üì®\n\n–í–∞—à –∑–∞–ø—Ä–æ—Å: '{original_text}'\n\nü§ñ –Ø –æ–±—Ä–∞–±–æ—Ç–∞–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –î–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–æ–º–æ—â–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:\n‚Ä¢ '–∑–∞–∫–∞–∑' - –æ—Ñ–æ—Ä–º–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ\n‚Ä¢ '—Ü–µ–Ω—ã' - —É–∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å\n‚Ä¢ '–∫—Ä—É–∏–∑—ã' - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã\n\nüìû –°—Ä–æ—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã: +7 (800) 555-35-35"
            
            # –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
            asyncio.run(bot.send_message(chat_id=chat_id, text=reply, disable_notification=True))
            
        except Exception as e:
            print(f"Error: {e}")
            try:
                asyncio.run(bot.send_message(chat_id=chat_id, text="‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –ø–æ–∑–≤–æ–Ω–∏—Ç–µ +7 (800) 555-35-35", disable_notification=True))
            except:
                pass
    
    return 'ok', 200

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)